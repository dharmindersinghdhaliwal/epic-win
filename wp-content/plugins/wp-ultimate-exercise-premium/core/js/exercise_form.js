jQuery(document).ready(function(){function e(e){if(!tinyMCE.activeEditor||tinyMCE.activeEditor.isHidden()){var i=d.val();d.val(i+e)}else tinyMCE.execCommand("mceInsertContent",!1,e)}function i(){var e=jQuery("#exercise-ingredients tr.ingredient-group-stub"),i=jQuery("#exercise-ingredients tr:last"),t=e.clone(!0);t.insertAfter(i).removeClass("ingredient-group-stub").addClass("ingredient-group"),jQuery(".ingredient-groups-disabled").hide(),jQuery(".ingredient-groups-enabled").show(),r()}function r(){1==jQuery(".ingredient-group").length?(jQuery("#exercise-ingredients .ingredient .ingredients_group").val(""),jQuery(".ingredient-groups-disabled").show(),jQuery(".ingredient-groups-enabled").hide()):(jQuery("#exercise-ingredients tr.ingredient").each(function(e,i){var r=jQuery(i).prevAll(".ingredient-group:first").find(".ingredient-group-label").val();void 0===r&&(r=jQuery(".ingredient-group-first").find(".ingredient-group-label").val()),jQuery(i).find(".ingredients_group").val(r)}),jQuery(".ingredient-groups-disabled").hide(),jQuery(".ingredient-groups-enabled").show())}function t(){var e=jQuery("#exercise-instructions tr.instruction-group-stub"),i=jQuery("#exercise-instructions tr:last"),r=e.clone(!0);r.insertAfter(i).removeClass("instruction-group-stub").addClass("instruction-group"),jQuery(".instruction-groups-disabled").hide(),jQuery(".instruction-groups-enabled").show(),n()}function n(){1==jQuery(".instruction-group").length?(jQuery("#exercise-instructions .instruction .instructions_group").val(""),jQuery(".instruction-groups-disabled").show(),jQuery(".instruction-groups-enabled").hide()):(jQuery("#exercise-instructions tr.instruction").each(function(e,i){var r=jQuery(i).prevAll(".instruction-group:first").find(".instruction-group-label").val();void 0===r&&(r=jQuery(".instruction-group-first").find(".instruction-group-label").val()),jQuery(i).find(".instructions_group").val(r)}),jQuery(".instruction-groups-disabled").hide(),jQuery(".instruction-groups-enabled").show())}function s(){var e=jQuery("#exercise-ingredients tr.ingredient").length,i=jQuery("#exercise-ingredients tr:last"),t=jQuery("#exercise-ingredients tr.ingredient:last"),n=t.clone(!0);n.insertAfter(i).find("input, select").val("").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)}).parent().find("input.ingredients_name").attr("onfocus",function(i,r){return r.replace(/(\d+)/,e)}),t.find("input").attr("placeholder",""),n.find("span.ingredients-delete").show(),a(),jQuery("#exercise-ingredients tr:last .ingredients_amount").focus(),r()}function a(){jQuery("#exercise-ingredients .ingredients_notes").unbind("keydown").last().bind("keydown",function(e){var i=e.keyCode||e.which;9==i&&(e.preventDefault(),s())})}function u(){jQuery("#exercise-ingredients tr.ingredient").each(function(e){jQuery(this).find("input").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)}).parent().find("input.ingredients_name").attr("onfocus",function(i,r){return r.replace(/(\d+)/,e)})})}function c(){var e=jQuery("#exercise-instructions tr.instruction").length,i=jQuery("#exercise-instructions tr.instruction:last").clone(!0);i.insertAfter("#exercise-instructions tr:last").find("textarea").val("").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)}),i.find(".exercise_instructions_remove_image").addClass("wpuep-hide"),i.find(".exercise_instructions_add_image").removeClass("wpuep-hide"),i.find(".exercise_instructions_image").val(""),i.find(".exercise_instructions_thumbnail").attr("src",wpuep_exercise_form.coreUrl+"/img/image_placeholder.png"),i.find(".exercise_instructions_image").attr("name",function(i,r){return r.replace(/(\d+)/,e)}),i.find(".instructions_group").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)}),i.find("span.instructions-delete").show(),o(),jQuery("#exercise-instructions tr:last textarea").focus(),n()}function o(){jQuery("#exercise-instructions textarea").unbind("keydown").last().bind("keydown",function(e){var i=e.keyCode||e.which;if(9==i&&0==e.shiftKey){var r=jQuery("#exercise-instructions tr:last").find("textarea").is(":focus");1==r&&(e.preventDefault(),c())}})}function l(){jQuery("#exercise-instructions tr.instruction").each(function(e){jQuery(this).find("textarea").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)}),jQuery(this).find(".exercise_instructions_image").attr("name",function(i,r){return r.replace(/(\d+)/,e)}),jQuery(this).find(".instructions_group").attr("name",function(i,r){return r.replace(/(\d+)/,e)}).attr("id",function(i,r){return r.replace(/(\d+)/,e)})})}jQuery("#insert-exercise-shortcode").on("click",function(){e("[exercise]")}),jQuery("#insert-nutrition-shortcode").on("click",function(){e("[nutrition-label]")});var d=jQuery("textarea#content");if(d.length>0){var g=d.val();g=g.replace(/<div class="wpuep-searchable-exercise"[^<]*<\/div>/g,function(e){return""}),g=g.replace(/\[wpuep-searchable-exercise\][^\[]*\[\/wpuep-searchable-exercise\]/g,function(e){return""}),d.val(g)}jQuery("#exercise-ingredients tr.ingredient:first").find("span.ingredients-delete").hide(),jQuery("#exercise-instructions tr.instruction:first").find("span.instructions-delete").hide();var p=jQuery("select#exercise_rating");if(1==p.length){for(var m=p.find("option:selected").val(),f='<img src="'+wpuep_exercise_form.coreUrl+'/img/star.png" width="15" height="14" />',v='<img src="'+wpuep_exercise_form.coreUrl+'/img/star_grey.png" width="15" height="14" />',y='<div id="exercise_rating_star_selection">',h=1;5>=h;h++)y+='<span class="star" id="exercise-star-'+h+'" data-star="'+h+'">',y+=m>=h?f:v,y+="</span>";y+="</div>",p.hide().after(y),jQuery(document).on("click","#exercise_rating_star_selection .star",function(){var e=jQuery(this);e.html(f).prevAll().html(f),e.nextAll().html(v),p.val(e.data("star"))})}r(),jQuery("#ingredients-add-group").on("click",function(e){e.preventDefault(),i()});var _;jQuery(".ingredient-group-label").on("input",function(){window.clearTimeout(_),_=window.setTimeout(function(){r()},500)}),jQuery(".ingredient-group-delete").on("click",function(){jQuery(this).parents("tr").remove(),r()}),n(),jQuery("#instructions-add-group").on("click",function(e){e.preventDefault(),t()});var j;jQuery(".instruction-group-label").on("input",function(){window.clearTimeout(j),j=window.setTimeout(function(){n()},500)}),jQuery(".instruction-group-delete").on("click",function(){jQuery(this).parents("tr").remove(),n()}),jQuery("#exercise-ingredients tbody").sortable({opacity:.6,revert:!0,cursor:"move",handle:".sort-handle",update:function(){a(),r(),u()}}),jQuery("#exercise-ingredients").on("keydown",function(e){var i=e.keyCode||e.which;9==i&&jQuery("ul.ac_results").hide()}),jQuery("#exercise-ingredients").on("click",function(){jQuery("ul.ac_results").hide()}),jQuery(".ingredients-delete").on("click",function(){jQuery(this).parents("tr").remove(),a(),u()}),jQuery("#ingredients-add").on("click",function(e){e.preventDefault(),s()}),a(),jQuery("#exercise-instructions tbody").sortable({opacity:.6,revert:!0,cursor:"move",handle:".sort-handle",update:function(){o(),n(),l()}}),jQuery(".instructions-delete").on("click",function(){jQuery(this).parents("tr").remove(),o(),l()}),jQuery("#instructions-add").on("click",function(e){e.preventDefault(),c()}),o(),jQuery(".exercise_thumbnail_add_image").on("click",function(e){e.preventDefault();var i=jQuery(this);if(image=i.siblings(".exercise_thumbnail_image"),preview=i.siblings(".exercise_thumbnail"),"function"==typeof wp.media)var r=wp.media({title:"Insert Media",button:{text:"Add featured image"},multiple:!1}).on("select",function(){var e=r.state().get("selection").first().toJSON();jQuery(preview).attr("src",e.url),jQuery(image).val(e.id).trigger("change")}).open();else post_id=i.attr("rel"),tb_show(i.attr("value"),"wp-admin/media-upload.php?post_id="+post_id+"&type=image&TB_iframe=1"),window.send_to_editor=function(e){img=jQuery("img",e),imgurl=img.attr("src"),classes=img.attr("class"),id=classes.replace(/(.*?)wp-image-/,""),image.val(id).trigger("change"),preview.attr("src",imgurl),tb_remove()}}),jQuery(".exercise_thumbnail_remove_image").on("click",function(e){e.preventDefault();var i=jQuery(this);i.siblings(".exercise_thumbnail_image").val("").trigger("change"),i.siblings(".exercise_thumbnail").attr("src",wpuep_exercise_form.coreUrl+"/img/image_placeholder.png")}),jQuery(".exercise_thumbnail_image").on("change",function(){var e=jQuery(this);""==e.val()?(e.siblings(".exercise_thumbnail_add_image").removeClass("wpuep-hide"),e.siblings(".exercise_thumbnail_remove_image").addClass("wpuep-hide")):(e.siblings(".exercise_thumbnail_remove_image").removeClass("wpuep-hide"),e.siblings(".exercise_thumbnail_add_image").addClass("wpuep-hide"))}),jQuery(".exercise_instructions_add_image").on("click",function(e){e.preventDefault();var i=jQuery(this);if(image=i.siblings(".exercise_instructions_image"),preview=i.siblings(".exercise_instructions_thumbnail"),"function"==typeof wp.media)var r=wp.media({title:"Insert Media",button:{text:"Add instruction image"},multiple:!1}).on("select",function(){var e=r.state().get("selection").first().toJSON();jQuery(preview).attr("src",e.url),jQuery(image).val(e.id).trigger("change")}).open();else post_id=i.attr("rel"),tb_show(i.attr("value"),"wp-admin/media-upload.php?post_id="+post_id+"&type=image&TB_iframe=1"),window.send_to_editor=function(e){img=jQuery("img",e),imgurl=img.attr("src"),classes=img.attr("class"),id=classes.replace(/(.*?)wp-image-/,""),image.val(id).trigger("change"),preview.attr("src",imgurl),tb_remove()}}),jQuery(".exercise_instructions_remove_image").on("click",function(e){e.preventDefault();var i=jQuery(this);i.siblings(".exercise_instructions_image").val("").trigger("change"),i.siblings(".exercise_instructions_thumbnail").attr("src",wpuep_exercise_form.coreUrl+"/img/image_placeholder.png")}),jQuery(".exercise_instructions_image").on("change",function(){var e=jQuery(this);""==e.val()?(e.siblings(".exercise_instructions_add_image").removeClass("wpuep-hide"),e.siblings(".exercise_instructions_remove_image").addClass("wpuep-hide")):(e.siblings(".exercise_instructions_remove_image").removeClass("wpuep-hide"),e.siblings(".exercise_instructions_add_image").addClass("wpuep-hide"))}),jQuery("#wpuep-insert-exercise").on("click",function(){var e="[ultimate-exercise id=";e+=jQuery("#wpuep-exercise").find("option:selected").val(),e+="]",tinyMCE.activeEditor.execCommand("mceInsertContent",0,e),tinyMCE.activeEditor.windowManager.close()}),jQuery(".wpuep-preview-select").on("change",function(){var e=jQuery(this).siblings(".wpuep-preview-img").children("img").attr("alt");e.split("-").length>1&&(e=e.split("-")[0]+"-");var i=jQuery(this).siblings(".wpuep-preview-img").children("img").attr("src"),r=e+jQuery(this).val()+".jpg",t=i.split("/");t=t[t.length-1],r=i.replace(t,r),jQuery(this).siblings(".wpuep-preview-img").children("img").attr("src",r)}),jQuery(".wpuep-file-upload").on("click",function(e){e.preventDefault();var i=jQuery(this);if(preview=i.siblings("img"),fieldname=preview.attr("class"),image=i.siblings("."+fieldname+"_image"),"function"==typeof wp.media)var r=wp.media({title:"Insert Media",button:{text:"Add image"},multiple:!1}).on("select",function(){var e=r.state().get("selection").first().toJSON();jQuery(preview).attr("src",e.url),jQuery(image).val(e.id)}).open();else post_id=i.attr("rel"),tb_show(i.attr("value"),"wp-admin/media-upload.php?post_id="+post_id+"&type=image&TB_iframe=1"),window.send_to_editor=function(e){img=jQuery("img",e),imgurl=img.attr("src"),classes=img.attr("class"),id=classes.replace(/(.*?)wp-image-/,""),image.val(id).trigger("change"),preview.attr("src",imgurl),tb_remove()};i.addClass("wpuep-hide"),i.siblings(".wpuep-file-remove").removeClass("wpuep-hide")}),jQuery(".wpuep-file-remove").on("click",function(e){e.preventDefault();var i=jQuery(this);preview=i.siblings("img"),fieldname=preview.attr("class"),i.siblings("."+fieldname+"_image").val(""),i.siblings("."+fieldname).attr("src",""),i.siblings(".wpuep-file-upload").removeClass("wpuep-hide"),i.addClass("wpuep-hide")})});